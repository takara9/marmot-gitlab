- name: basic information
  hosts: all
  gather_facts: true
  become: true
  #
  vars:
    cluster_admin: ubuntu
    admin_user:    ubuntu
    mail_domain:   "labo.local"    
    my_host:       "gitlab"
    fqdn:          "{{ my_host }}.labo.local"
    my_data:       "/gitlab"
    dst_dir:       "/gitlab/config/ssl"
    disk_sdc:      "{{ my_data }}"
    
  #   
  roles:
    - base_linux
    - docker
    - vdisks
    - download_certs
    - mail-client

  # 
  tasks:
  - name: Re-Start dockerd
    systemd:
      name: docker
      state: restarted
      daemon_reload: yes
      enabled: yes
    
  - name: copy docker-compose.yml
    template:
      src: docker-compose.yml
      dest: "{{ my_data }}"

  - name: Start Gitlab container
    shell: |
      docker-compose up -d
    args:
      chdir: "{{ my_data }}"
